= ToDo web service

A RESTful web service to managing ToDo items. ToDo items are stored in a database. The underlying implementation is based on Spring Boot built by Gradle. The provided `Jenkinsfile` defines a build pipeline definition for creating, pushing and deploying a Docker image of the application.

== Prerequisites

The application requires **Java 17** to build and run (tested with Amazon Corretto 17).

=== Install Amazon Corretto 17

.Download and install

- **macOS (Homebrew)**:
+
----
$ brew tap homebrew/cask-versions
$ brew install --cask corretto17
----

- **Linux**: download the appropriate Amazon Corretto 17 package for your distribution from the Amazon Corretto downloads page and install it using your system's package manager.

=== Set `JAVA_HOME` to Corretto 17

After installing Corretto 17, set `JAVA_HOME` and update your `PATH` (example for bash/zsh on macOS or Linux):

----
export JAVA_HOME=$(/usr/libexec/java_home -v 17)   # macOS
export PATH="$JAVA_HOME/bin:$PATH"
----

On Linux, adjust `JAVA_HOME` to the installation path, for example:

----
export JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto
export PATH="$JAVA_HOME/bin:$PATH"
----

Verify the Java version:

----
java -version
----

You should see a Corretto 17 build reported.

=== Preparing PostgreSQL for the `dev` profile

The `dev` profile expects a PostgreSQL database named `todo` with a user `postgres` (password `postgres` by default, see `src/main/resources/application-dev.properties`).

.Install PostgreSQL (if not already installed)
----
# macOS (Homebrew)
$ brew install postgresql
$ brew services start postgresql
----

On Linux, install PostgreSQL using your distribution's package manager (for example `apt`, `dnf`, or `yum`) and ensure the PostgreSQL service is running.

.Create the `todo` database and `postgres` user/password

Connect to PostgreSQL as the superuser (usually `postgres`):

----
$ psql -U postgres
----

Inside the `psql` shell, ensure the `postgres` user has a password and create the `todo` database:

----
postgres=# ALTER USER postgres WITH PASSWORD 'postgres';
postgres=# CREATE DATABASE todo OWNER postgres;
----

Adjust the connection URL, username and password in `application-dev.properties` if your PostgreSQL setup differs (host, port, database name, or credentials).


== Running the service locally

Execute the task `bootRun` with the Gradle Wrapper command to bring up the service. Optional arguments can be provided e.g. the server port. The following example starts the application on port 9090.

----
$ ./gradlew bootRun --args='--server.port=9090'
----

You can activate a profile by passing in the relevant environment. At the moment `dev` and `prod` is supported. The default profile uses a H2 database. The `dev` profile assumes the usage of a PostgreSQL database for development purposes. The `prod` profile is used for production environments.

The following example uses the development profile.

----
$ ./gradlew bootRun --args='--spring.profiles.active=dev'
----
== Running the service in Docker container

Using the default profile:

----
$ docker run -p 8080:8080 -t bmuschko/todo-web-service
----

To use the production profile, pass in the `SPRING_PROFILES_ACTIVE` environment variable:

----
$ docker run -e "SPRING_PROFILES_ACTIVE=prod" -p 8080:8080 -t bmuschko/todo-web-service
----

== Using the API

Once the service is up and running, you can call the exposed CRUD endpoints.

=== Getting all items

Example command:

----
$ curl -u admin:password123 -X GET localhost:8080/todos
----

Example response:

----
[
   {
      "id":1,
      "name":"Buy milk",
      "completed":false
   },
   {
      "id":2,
      "name":"Pay bills",
      "completed":true
   }
]
----

=== Getting an existing item

Example command:

----
$ curl -u admin:password123 -X GET localhost:8080/todos/2
----

Example response:

----
{
   "id":2,
   "name":"Pay bills",
   "completed":true
}
----

=== Creating a new item

Example command:

----
$ curl -u admin:password123 -X POST -H "Content-Type:application/json" -d '{ "name" : "Buy milk", "completed" : false }' localhost:8080/todos
----

=== Deleting an existing item

Example command:

----
$ curl -u admin:password123 -X DELETE localhost:8080/todos/2
----

=== Updating an existing item

Example command:

----
$ curl -u admin:password123 -X PUT -H "Content-Type:application/json" -d '{ "name" : "Pay bills", "completed" : true }' localhost:8080/todos/2
----